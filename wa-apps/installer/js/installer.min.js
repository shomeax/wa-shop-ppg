(function(b){function a(k,a,l,e){e={data:e||(a?a.data:{}),_wrap:a?a._wrap:null,tmpl:null,parent:a||null,nodes:[],calls:p,nest:y,wrap:q,html:z,update:A};k&&b.extend(e,k,{nodes:[],parent:a});l&&(e.tmpl=l,e._ctnt=e._ctnt||e.tmpl(b,e),e.key=++r,(u.length?s:m)[r]=e);return e}function d(a,i,l){var e,l=l?b.map(l,function(b){return"string"===typeof b?a.key?b.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+o+'="'+a.key+'" $2'):b:d(b,a,b._ctnt)}):a;if(i)return l;l=l.join("");l.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(a,k,i,l){e=b(i).get();f(e);k&&(e=c(k).concat(e));l&&(e=e.concat(c(l)))});return e?e:c(l)}function c(a){var i=document.createElement("div");i.innerHTML=a;return b.makeArray(i.childNodes)}function g(a){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+b.trim(a).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(a,k,e,c,d,g,f){a=b.tmpl.tag[e];if(!a)throw"Template command not found: "+e;e=a._default||[];g&&!/\w$/.test(d)&&(d+=g,g="");d?(d=h(d),f=f?","+h(f)+")":g?")":"",f=g?-1<d.indexOf(".")?d+g:"("+d+").call($item"+f:d,g=g?f:"(typeof("+d+")==='function'?("+d+").call($item):("+d+"))"):g=f=e.$1||"null";c=h(c);return"');"+a[k?"close":"open"].split("$notnull_1").join(d?"typeof("+d+")!=='undefined' && ("+d+")!=null":"true").split("$1a").join(g).split("$1").join(f).split("$2").join(c?c.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,
function(b,a,k,e){return(e=e?","+e+")":k?")":"")?"("+a+").call($item"+e:b}):e.$2||"")+"_.push('"})+"');}return _;")}function j(a,i){a._wrap=d(a,!0,b.isArray(i)?i:[v.test(i)?i:b(i).html()]).join("")}function h(b){return b?b.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function f(k){function i(e){function k(b){b+=d;f=g[b]=g[b]||a(f,m[f.parent.key+d]||f.parent,null,!0)}var i,c=e,f,h;if(h=e.getAttribute(o)){for(;c.parentNode&&1===(c=c.parentNode).nodeType&&!(i=c.getAttribute(o)););if(i!==h){c=c.parentNode?
11===c.nodeType?0:c.getAttribute(o)||0:0;if(!(f=m[h]))f=s[h],f=a(f,m[c]||s[c],null,!0),f.key=++r,m[r]=f;n&&k(h)}e.removeAttribute(o)}else if(n&&(f=b.data(e,"tmplItem")))k(f.key),m[f.key]=f,c=(c=b.data(e.parentNode,"tmplItem"))?c.key:0;if(f){for(i=f;i&&i.key!=c;)i.nodes.push(e),i=i.parent;delete f._ctnt;delete f._wrap;b.data(e,"tmplItem",f)}}var d="_"+n,e,c,g={},f,j,h;f=0;for(j=k.length;f<j;f++)if(1===(e=k[f]).nodeType){c=e.getElementsByTagName("*");for(h=c.length-1;0<=h;h--)i(c[h]);i(e)}}function p(b,
a,c,e){if(!b)return u.pop();u.push({_:b,tmpl:a,item:this,data:c,options:e})}function y(a,c,d){return b.tmpl(b.template(a),c,d,this)}function q(a,c){var d=a.options||{};d.wrapped=c;return b.tmpl(b.template(a.tmpl),a.data,d,a.item)}function z(a,c){var d=this._wrap;return b.map(b(b.isArray(d)?d.join(""):d).filter(a||"*"),function(b){if(c)b=b.innerText||b.textContent;else{var a;if(!(a=b.outerHTML))a=document.createElement("div"),a.appendChild(b.cloneNode(!0)),a=a.innerHTML;b=a}return b})}function A(){var a=
this.nodes;b.tmpl(null,null,null,this).insertBefore(a[0]);b(a).remove()}var w=b.fn.domManip,o="_tmplitem",v=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,m={},s={},t,x={key:0,data:{}},r=0,n=0,u=[];b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,c){b.fn[a]=function(d){var e=[],d=b(d),f,g,h;f=1===this.length&&this[0].parentNode;t=m||{};if(f&&11===f.nodeType&&1===f.childNodes.length&&1===d.length)d[c](this[0]),e=this;else{g=0;for(h=d.length;g<
h;g++)n=g,f=(0<g?this.clone(!0):this).get(),b.fn[c].apply(b(d[g]),f),e=e.concat(f);n=0;e=this.pushStack(e,a,d.selector)}d=t;t=null;b.tmpl.complete(d);return e}});b.fn.extend({tmpl:function(a,d,c){return b.tmpl(this[0],a,d,c)},tmplItem:function(){return b.tmplItem(this[0])},template:function(a){return b.template(a,this[0])},domManip:function(a,d,c){if(a[0]&&a[0].nodeType){for(var e=b.makeArray(arguments),f=a.length,g=0,h;g<f&&!(h=b.data(a[g++],"tmplItem")););1<f&&(e[0]=[b.makeArray(a)]);h&&n&&(e[2]=
function(a){b.tmpl.afterManip(this,a,c)});w.apply(this,e)}else w.apply(this,arguments);n=0;!t&&b.tmpl.complete(m);return this}});b.extend({tmpl:function(c,f,g,e){var h=!e;if(h)e=x,c=b.template[c]||b.template(null,c),s={};else if(!c)return c=e.tmpl,m[e.key]=e,e.nodes=[],e.wrapped&&j(e,e.wrapped),b(d(e,null,e.tmpl(b,e)));if(!c)return[];"function"===typeof f&&(f=f.call(e||{}));g&&g.wrapped&&j(g,g.wrapped);f=b.isArray(f)?b.map(f,function(b){return b?a(g,e,c,b):null}):[a(g,e,c,f)];return h?b(d(e,null,
f)):f},tmplItem:function(a){var c;for(a instanceof b&&(a=a[0]);a&&1===a.nodeType&&!(c=b.data(a,"tmplItem"))&&(a=a.parentNode););return c||x},template:function(a,c){return c?("string"===typeof c?c=g(c):c instanceof b&&(c=c[0]||{}),c.nodeType&&(c=b.data(c,"tmpl")||b.data(c,"tmpl",g(c.innerHTML))),"string"===typeof a?b.template[a]=c:c):a?"string"!==typeof a?b.template(null,a):b.template[a]||b.template(null,v.test(a)?a:b(a)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});
b.extend(b.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},
open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){m={}},afterManip:function(a,c,d){var e=11===c.nodeType?b.makeArray(c.childNodes):1===c.nodeType?[c]:[];d.call(a,c);f(e);n++}})})(jQuery);var translate={};String.prototype.translate=function(){return translate[this]?translate[this]:this};(function(){var b=this.console,a=this.console={};a.production=!1;b&&!b.time&&(b.time=function(b,c){if(b){var d=(new Date).getTime();a.timeCounters||(a.timeCounters={});var f="KEY"+b.toString();if(c||!a.timeCounters[f])a.timeCounters[f]=d}},b.timeEnd=function(b){var c=(new Date).getTime();if(a.timeCounters){var d="KEY"+b.toString(),f=a.timeCounters[d];if(f){var p=c-f;a.info(b+": "+p+"ms");delete a.timeCounters[d]}return p}});for(var d="assert count debug dir dirxml error group groupCollapsed groupEnd info log markTimeline profile profileEnd table time timeEnd trace warn".split(" "),
c=d.length;c--;)(function(c){a[c]=function(){if(b&&c in b&&!a.production)try{b[c].apply(b,arguments)}catch(d){alert(arguments)}}})(d[c])})();
(function(b){b.installer={options:{updateStateInterval:2E3,updateStateErrorInterval:6E3,queue:[],install:!1,logMode:"raw",end:null},timeout:{state:null},counter:0,timestamp:0,complete:null,init:function(a){this.trace("init");this.options=b.extend({},this.options,a||{});var d=this,c=/<\\\/(\w+)/g;b("script[type$='x-jquery-tmpl']").each(function(){var a=b(this).attr("id").replace(/-template-js$/,"");d.trace("compile template "+a);try{b.template(a,b(this).html().replace(c,"</$1"))}catch(j){console.error(j)}});
this.options.queue.length?this.execute("update",this.options.queue):this.execute("state",null);b("body").addClass("i-fixed-body");this.onResize();b(window).resize(function(){d.onResize()})},onResize:function(){setInterval(function(){b(".content .i-app-update-screen").css("max-height",parseInt(b("#wa").css("height"))-110+"px")},500)},execute:function(a,b){a=a||"default";this.trace("execute action "+a,b);if(this[a+"Action"]){this.currentAction=a;this.currentActionAttr=b;try{return this[a+"Action"](b)}catch(c){console.error("Exception while execute "+
a+"Action",c)}}else console.error("Invalid action name",a+"Action")},defaultAction:function(){},stateAction:function(){var a=this;try{this.sendRequest("?module=update&action=state",{mode:this.options.logMode},function(b){a.updateStateHandler(b)},function(b){a.updateStateErrorHandler(b)})}catch(b){console.error("Exception while execute stateAction",b),this.execute("state",null)}},updateAction:function(a){var d=this;this.sendRequest("?module=update&action=execute",{app_id:a,mode:this.options.logMode,
install:this.options.install?"1":"0"},function(a){try{d.updateExecuteHandler(a)}catch(b){console.error("Exception while execute updateExecuteHandler",b)}},function(a){try{d.updateExecuteErrorHandler(a)}catch(b){console.error("Exception while execute updateExecuteErrorHandler",b)}},function(){d.timeout.state=setTimeout(function(){d.execute("state",null)},Math.max(2E3,4*d.options.updateStateInterval))});setTimeout(function(){b("#wa-app-installer a span.indicator").remove()},500)},updateExecuteHandler:function(a){this.trace("updateExecuteHandler",
a);this.timeout.state&&clearTimeout(this.timeout.state);var d={success:0,success_plural:0,fail:0,fail_plural:0},c={},g=!1,j="generic",h;if(a){this.complete=!0;if(a.sources)for(id in a.sources)a.sources[id].target.match(/^wa-apps/)&&(j=(h=a.sources[id].target.match(/^wa-apps\/\w+\/(\w+)/))?"app_"+h[1]:"apps",c[j]||(c[j]={success:0,fail:0,plural:null}),a.sources[id].skipped?(++d.fail,g=g||"no",++c[j].fail):(++d.success,g=g||"yes",++c[j].success));c=d.success;d.success_plural=1==c%10&&11!=c%100?0:2<=
c%10&&4>=c%10&&(10>c%100||20<=c%100)?1:2;c=d.fail;d.fail_plural=1==c%10&&11!=c%100?0:2<=c%10&&4>=c%10&&(10>c%100||20<=c%100)?1:2;this.drawStateInfo(a.state,g||"no");setTimeout(function(){b.tmpl("application-update-result",{current_state:a.current_state,result:d,sources:a.sources}).appendTo("#update-raw");setTimeout(function(){var a=b("div.i-app-update-screen :last").offset().top;b("div.i-app-update-screen").scrollTop(a);b("#update-result-apps li").each(function(){b(this).parent().show();var a=b(this).offset(),
c=null,d=b("#wa-applist ul li[id^="+b(this).attr("id")+"]");d.length?c=d.offset():(c=b("#wa-applist ul li #wa-moreapps").offset(),c.left||(c=b("#wa-applist ul li[id^=wa-app-]:last").offset(),c.left+=75));var c={left:c.left,top:c.top},a={top:a.top,left:a.left,position:"absolute",display:"inline-block"},f={top:0,left:0,position:"relative",display:"inline-block"};b(this).css(a);var g=b(this);b(this).animate(c,700,function(){g.css(f);d.length?d.replaceWith(g):g.appendTo("#wa-applist ul");b(window).resize()})})},
500)},500)}},updateExecuteErrorHandler:function(a){this.trace("updateExecuteErrorHandler",a)},updateStateHandler:function(a){this.trace("stateHandler",a);(this.timeout.state||this.complete)&&clearTimeout(this.timeout.state);if(!this.complete)if(a.current_state&&("error"==a.current_state.stage_status||"complete"==a.current_state.stage_status&&"update"==a.current_state.stage_name&&3<parseInt(a.current_state.stage_elapsed_time))){var d="yes";"error"==a.current_state.stage_status&&(d="no");this.drawStateInfo(a.state,
d);b.tmpl("application-update-result",{current_state:a.current_state,result:null}).appendTo("#update-raw")}else if(a.current_state&&a.state){this.drawStateInfo(a.state);var c=this;this.timeout.state=setTimeout(function(){c.complete||c.execute("state",null)},this.options.updateStateInterval)}},updateStateErrorHandler:function(a){this.trace("StateErrorHandler",a);this.timeout.state&&clearTimeout(this.timeout.state);var b=this;this.timeout.state=setTimeout(function(){b.complete||b.execute("state",null)},
this.options.updateStateErrorInterval)},drawStateInfo:function(a,d){d=d||"loading";switch(this.options.logMode){case "raw":if(a&&a.length){for(id in a)a[id].datetime||(a[id].datetime=new Date(1E3*parseInt(a[id].stage_start_time)));var c=b("#template-placeholder").html();try{b("#template-placeholder").empty(),b.tmpl("application-update-raw",{stages:a,apps:this.options.queue,state_class:d}).appendTo("#template-placeholder")}catch(g){console.error("Error while parse template ",g),b("#template-placeholder").html(c)}}break;
default:c=b("#template-placeholder").html();try{for(app_id in b("#template-placeholder").empty(),a){for(id in a[app_id])a[app_id][id].datetime||(a[app_id][id].datetime=new Date(1E3*parseInt(a[app_id][id].stage_start_time)));var j=new Date(1E3*parseInt(a[app_id][1].stage_start_time));b.tmpl("application-update-apps",{slug:app_id,timestamp:j,stages:a[app_id],state_class:d}).appendTo("#template-placeholder")}}catch(h){console.error("Error while parse template ",h),b("#template-placeholder").html(c)}}setTimeout(function(){var a=
b("div.i-app-update-screen :last").offset().top;b("div.i-app-update-screen").scrollTop(a);b("#wa-app-installer a span.indicator").remove()},100)},trace:function(){},sendRequest:function(a,d,c,g,j){var h=this;b.ajax({url:a+"&timestamp="+(new Date).getTime(),data:d,type:"GET",dataType:"json",success:function(a,d){try{try{"object"!=typeof a&&(a=b.parseJSON(a))}catch(j){throw console.error("Invalid server JSON response",j),"function"==typeof g&&g(),j;}if(a)switch(a.status){case "fail":h.displayMessage(a.errors.error||
a.errors,"error");"function"==typeof g&&g(a);break;case "ok":"function"==typeof c&&c(a.data);break;default:console.error("unknown status response",a.status),"function"==typeof g&&g(a)}else console.error("empty response",d),"function"==typeof g&&g(),h.displayMessage("Empty server response","warning")}catch(q){console.error("Error handling server response ",q),"function"==typeof g&&g(a),h.displayMessage("Invalid server response<br>"+q.description,"error")}},error:function(a,b){console.error("AJAX request error",
b);"function"==typeof g&&g();h.displayMessage("AJAX request error","warning")},beforeSend:j})},displayMessage:function(){}}})(jQuery,this);
